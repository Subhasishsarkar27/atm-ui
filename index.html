<!DOCTYPE html>
<html>
<head>
    <title>ATM with Keypad</title>
    <style>
        body {
            background-color: #111;
            font-family: Arial;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            color: white;
        }
        .atm {
            background: #003366;
            padding: 20px;
            width: 360px;
            border-radius: 12px;
            text-align: center;
        }
        p {
            min-height: 40px;
        }
        input {
            width: 90%;
            padding: 10px;
            font-size: 18px;
            margin: 10px 0;
            text-align: center;
        }
        button {
            padding: 10px;
            font-size: 16px;
            cursor: pointer;
        }
        .hidden {
            display: none;
        }
        .keypad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-top: 10px;
        }
        .keypad button {
            font-size: 25px;
            padding: 12px;
        }
        .green { background: #2ecc71; }
        .red { background: #e74c3c; }
        .yellow { background: #f1c40f; }
    </style>
</head>

<body>

<div class="atm">
    <h2 id="title">Welcome</h2>
    <p id="message">Set your 4-digit PIN</p>

    <input type="password" id="input" maxlength="4" readonly>

    <div class="keypad" id="keypad">
        <button onclick="press(1)">1</button>
        <button onclick="press(2)">2</button>
        <button onclick="press(3)">3</button>
        <button onclick="press(4)">4</button>
        <button onclick="press(5)">5</button>
        <button onclick="press(6)">6</button>
        <button onclick="press(7)">7</button>
        <button onclick="press(8)">8</button>
        <button onclick="press(9)">9</button>
        <button class="yellow" onclick="clearInput()">Clear</button>
        <button onclick="press(0)">0</button>
        <button class="green" onclick="enter()">Enter</button>
        <button class="red" onclick="cancel()">Cancel</button>
    </div>
</div>

<script>
    let pin = "", tempPin = "";
    let balance = 0;
    let stage = "setPin";
    let attempts = 0;

    function press(num) {
        if (input.value.length < input.maxLength) {
            input.value += num;
        }
    }

    function clearInput() {
        input.value = "";
    }

    function cancel() {
        if (stage === "menu") return;
        showMenu();
    }

    function enter() {
        if (stage === "setPin" || stage === "confirmPin") handlePin();
        else if (stage === "login") login();
        else if (stage === "withdraw") confirmWithdraw();
        else if (stage === "deposit") confirmDeposit();
    }

    function handlePin() {
        let val = input.value;
        if (val.length !== 4) {
            showMessage("PIN must be 4 digits");
            return;
        }

        if (stage === "setPin") {
            tempPin = val;
            stage = "confirmPin";
            showMessage("Confirm your PIN");
        } else if (stage === "confirmPin") {
            if (val === tempPin) {
                pin = val;
                stage = "login";
                showMessage("PIN set. Enter PIN to login");
            } else {
                stage = "setPin";
                tempPin = "";
                showMessage("PIN mismatch. Set PIN again");
            }
        }
        clearInput();
    }

    function login() {
        let val = input.value;
        if (val !== pin) {
            attempts++;
            if (attempts >= 3) {
                showMessage("Card blocked");
                keypad.classList.add("hidden");
                return;
            }
            showMessage("Wrong PIN. Attempts left: " + (3 - attempts));
            clearInput();
            return;
        }
        attempts = 0;
        showMenu();
    }

    function showMenu() {
        stage = "menu";
        title.innerText = "ATM Menu";
        input.classList.add("hidden");
        keypad.classList.add("hidden");
        document.getElementById("message").innerHTML = `
            <button onclick="checkBalance()">Check Balance</button><br>
            <button onclick="startWithdraw()">Withdraw</button><br>
            <button onclick="startDeposit()">Deposit</button><br>
            <button onclick="location.reload()">Exit</button>
        `;
    }

    function checkBalance() {
        showMessage("Balance: ₹" + balance);
    }

    function startWithdraw() {
        stage = "withdraw";
        input.type = "number";
        input.value = "";
        input.classList.remove("hidden");
        keypad.classList.remove("hidden");
        showMessage("Enter amount to withdraw");
    }

    function confirmWithdraw() {
        let amt = Number(input.value);
        if (amt <= 0 || amt > balance) {
            showMessage("Invalid amount");
            return;
        }
        balance -= amt;
        showMessage("₹" + amt + " withdrawn");
        showMenu();
    }

    function startDeposit() {
        stage = "deposit";
        input.type = "number";
        input.value = "";
        input.classList.remove("hidden");
        keypad.classList.remove("hidden");
        showMessage("Enter amount to deposit");
    }

    function confirmDeposit() {
        let amt = Number(input.value);
        if (amt <= 0) {
            showMessage("Invalid amount");
            return;
        }
        balance += amt;
        showMessage("₹" + amt + " deposited");
        showMenu();
    }

    function showMessage(msg) {
        message.innerText = msg;
    }
</script>

</body>
</html>